<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Config Extraction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        #test-chart {
            width: 800px;
            height: 500px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Test Config Extraction</h1>
    <p>Testing that SankeyChart works with extracted configuration using IIFE pattern.</p>
    
    <div id="result" class="test-result">Testing...</div>
    <div id="test-chart"></div>

    <!-- Load Dependencies -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    
    <!-- Load Config and Chart -->
    <script src="js/utils/ChartUtils.js"></script>
    <script src="js/utils/ChartExports.js"></script>
    <script src="js/charts/sankey/SankeyChartConfig.js"></script>
    <script src="js/charts/sankey/SankeyChart.js"></script>

    <script>
        // Test data
        const testData = {
            "metadata": {
                "title": "Config Test",
                "currency": "USD",
                "unit": "thousands"
            },
            "nodes": [
                {"id": "Revenue", "depth": 0, "value": 1000, "category": "revenue"},
                {"id": "Expenses", "depth": 1, "value": 600, "category": "expense"},
                {"id": "Profit", "depth": 2, "value": 400, "category": "profit"}
            ],
            "links": [
                {"source": "Revenue", "target": "Expenses", "value": 600},
                {"source": "Revenue", "target": "Profit", "value": 400}
            ]
        };

        // Test the extraction
        try {
            // Test that config is available
            if (typeof SankeyChartConfig === 'undefined') {
                throw new Error('SankeyChartConfig not loaded');
            }
            
            if (typeof SankeyChartConfig.getInitialConfig !== 'function') {
                throw new Error('getInitialConfig function not available');
            }
            
            // Test config function
            const config = SankeyChartConfig.getInitialConfig();
            if (!config || typeof config !== 'object') {
                throw new Error('Config function returned invalid data');
            }
            
            if (config.width !== 1200 || config.height !== 700) {
                throw new Error('Config values are incorrect');
            }
            
            // Test chart creation
            const chart = new PulseSankeyChart('test-chart');
            
            // Test rendering
            chart.render(testData).then(() => {
                // Check if chart rendered properly
                const svg = document.querySelector('#test-chart svg');
                const nodes = svg ? svg.querySelectorAll('.sankey-node') : [];
                const links = svg ? svg.querySelectorAll('.sankey-link') : [];
                
                if (svg && nodes.length > 0 && links.length > 0) {
                    document.getElementById('result').className = 'test-result pass';
                    document.getElementById('result').textContent = 
                        `✅ SUCCESS: Config extraction works! Chart rendered with ${nodes.length} nodes and ${links.length} links.`;
                } else {
                    throw new Error('Chart did not render properly');
                }
            }).catch(error => {
                document.getElementById('result').className = 'test-result fail';
                document.getElementById('result').textContent = `❌ RENDER FAILED: ${error.message}`;
            });
            
        } catch (error) {
            document.getElementById('result').className = 'test-result fail';
            document.getElementById('result').textContent = `❌ TEST FAILED: ${error.message}`;
        }
    </script>
</body>
</html>