<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guided Flow Bar Chart Fix Test</title>
    
    <style>
        body {
            font-family: Inter, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            font-weight: 500;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Guided Flow Bar Chart Fix Test</h1>
        <p>This test simulates the guided flow to verify that bar chart controls load correctly.</p>
        
        <h3>Test Scenarios:</h3>
        
        <button class="test-button" onclick="testDirectBarChart()">
            📊 Test Direct Bar Chart URL
        </button>
        
        <button class="test-button" onclick="testGuidedFlowSimulation()">
            🎯 Test Guided Flow Simulation
        </button>
        
        <button class="test-button" onclick="testControlSwitching()">
            🔄 Test Control Panel Switching
        </button>
        
        <div id="test-results"></div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `<div class="test-status ${type}">${message}</div>`;
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        function testDirectBarChart() {
            showResult('🧪 Testing direct bar chart URL navigation...', 'info');
            console.log('🧪 Starting direct bar chart test');
            
            // Simulate the URL that would come from guided.html
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-guided-flow-fix.html', 'chart.html')}?chartType=bar`;
            
            console.log('🔗 Test URL:', testUrl);
            showResult(`🔗 Navigating to: ${testUrl}<br><br>⏳ This should load chart.html with bar chart controls...`, 'info');
            
            // Navigate after a short delay to show the message
            setTimeout(() => {
                window.location.href = testUrl;
            }, 2000);
        }

        function testGuidedFlowSimulation() {
            showResult('🧪 Testing guided flow simulation...', 'info');
            console.log('🧪 Starting guided flow simulation');
            
            // This simulates what guided.html does when "Bar Chart" is selected
            const simulatedData = {
                chartType: 'bar',
                source: 'guided-flow-test',
                categories: ['Sales Q1', 'Sales Q2', 'Sales Q3', 'Sales Q4'],
                values: [150000, 175000, 195000, 220000],
                labels: ['Q1 Sales', 'Q2 Sales', 'Q3 Sales', 'Q4 Sales']
            };
            
            // Encode data like guided.html does
            const encodedData = encodeURIComponent(JSON.stringify(simulatedData));
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-guided-flow-fix.html', 'chart.html')}?chartType=bar&data=${encodedData}`;
            
            console.log('🔗 Simulated guided flow URL:', testUrl);
            showResult(`🎯 Simulating guided flow with test data...<br><br>📊 This should load chart.html with bar chart and sample data...`, 'info');
            
            setTimeout(() => {
                window.location.href = testUrl;
            }, 2000);
        }

        function testControlSwitching() {
            showResult('🧪 Testing control panel switching...', 'info');
            console.log('🧪 Starting control switching test');
            
            // Navigate to chart.html first with sankey, then switch
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-guided-flow-fix.html', 'chart.html')}?type=income`;
            
            console.log('🔗 Starting with Sankey chart:', testUrl);
            showResult(`🔄 Loading Sankey chart first, then you can test switching to Bar chart...<br><br>📝 Look for the chart type dropdown in the header to switch between chart types.`, 'info');
            
            setTimeout(() => {
                window.location.href = testUrl;
            }, 2000);
        }

        // Show initial instructions
        showResult('👆 Click any test button above to verify the bar chart control fix.', 'info');
    </script>
</body>
</html>