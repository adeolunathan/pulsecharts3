<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse - Professional Financial Visualization Platform v2.0</title>
    
    <!-- Meta tags for better SEO and social sharing -->
    <meta name="description" content="Professional financial data visualization platform with interactive Sankey charts and advanced analytics.">
    <meta name="keywords" content="financial visualization, sankey chart, data analytics, business intelligence">
    <meta name="author" content="Pulse Financial Insights">
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Pulse Financial Visualization Platform">
    <meta property="og:description" content="Professional financial data visualization with interactive charts">
    <meta property="og:type" content="website">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/charts.css">
    
    <!-- Favicon (optional) -->
    <!-- <link rel="icon" type="image/x-icon" href="/favicon.ico"> -->
</head>
<body>
    <!-- Loading screen -->
    <div id="loading-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        z-index: 9999;
        font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    ">
        <div style="font-size: 48px; margin-bottom: 20px;">üìä</div>
        <div style="font-size: 24px; font-weight: 600; margin-bottom: 10px;">Pulse Financial Insights</div>
        <div style="font-size: 16px; opacity: 0.9; margin-bottom: 30px;">Loading visualization platform...</div>
        <div style="width: 200px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden;">
            <div id="loading-bar" style="width: 0%; height: 100%; background: white; border-radius: 2px; transition: width 0.3s ease;"></div>
        </div>
        <div id="loading-status" style="font-size: 14px; opacity: 0.8; margin-top: 15px;">Initializing core modules...</div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="app-title">Pulse<span style="font-size: 0.6em; opacity: 0.8; margin-left: 8px;">v2.0</span></h1>
            <p class="app-subtitle">Professional Financial Visualization Platform</p>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Chart Container -->
            <div class="chart-container">
                <div class="chart-header">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <h2 class="chart-title">Financial Flow Analysis</h2>
                        <div class="chart-type-indicator">Sankey</div>
                    </div>
                    <div class="chart-controls">
                        <!-- Export Controls -->
                        <div class="export-controls">
                            <button class="export-btn export-btn-primary" onclick="PulseApp.chart.export('png')" title="Export as PNG image">
                                üìä PNG
                            </button>
                            <button class="export-btn" onclick="PulseApp.chart.export('svg')" title="Export as SVG vector">
                                üìà SVG  
                            </button>
                            <button class="export-btn" onclick="PulseApp.chart.export('csv')" title="Export data as CSV">
                                üìã Data
                            </button>
                            <button class="export-btn export-btn-menu" onclick="PulseApp.chart.exportMenu()" title="Show export menu">
                                ‚öôÔ∏è Menu
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- The actual chart will be rendered here -->
                <div id="sankey-chart" class="chart-wrapper">
                    <div class="chart-loading">
                        <p>Initializing chart visualization...</p>
                    </div>
                </div>
            </div>

            <!-- Chart Information Panel -->
            <div class="info-panel">
                <div class="info-section">
                    <h3>Enhanced Platform v2.0</h3>
                    <p>This new version features a completely modular architecture with advanced error handling, event management, and configuration systems.</p>
                </div>
                
                <div class="info-section">
                    <h3>Key Features</h3>
                    <ul>
                        <li>Modular chart architecture</li>
                        <li>Advanced data processing</li>
                        <li>Professional export options</li>
                        <li>Real-time error handling</li>
                        <li>Event-driven interactions</li>
                        <li>Responsive design</li>
                    </ul>
                </div>
                
                <div class="info-section">
                    <h3>Keyboard Shortcuts</h3>
                    <ul>
                        <li><strong>Ctrl+S:</strong> Export PNG</li>
                        <li><strong>Ctrl+E:</strong> Export menu</li>
                        <li><strong>Ctrl+R:</strong> Refresh chart</li>
                        <li><strong>Ctrl+Shift+D:</strong> Debug mode</li>
                        <li><strong>F1:</strong> Help</li>
                    </ul>
                </div>
                
                <div class="info-section">
                    <h3>System Status</h3>
                    <div id="system-status" style="font-size: 12px; color: #6c757d;">
                        <div>Status: <span id="status-indicator">Initializing...</span></div>
                        <div>Version: <span id="version-indicator">v2.0.0</span></div>
                        <div>Modules: <span id="modules-indicator">Loading...</span></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>&copy; 2025 Pulse Financial Visualization Platform v2.0 - Enhanced Modular Architecture</p>
        </footer>
    </div>

    <!-- Debug Panel (development only) -->
    <div id="debug-panel" style="
        position: fixed; 
        bottom: 10px; 
        left: 10px; 
        background: rgba(0,0,0,0.8); 
        color: white;
        padding: 10px; 
        border-radius: 5px; 
        font-size: 12px; 
        display: none;
        z-index: 1000;
    ">
        <button onclick="toggleDebug()" style="
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 3px; 
            cursor: pointer;
            margin-bottom: 5px;
        ">Debug Panel</button>
        <div id="debug-info" style="display: none;">
            <button onclick="PulseApp.debug.getStats()" style="background: #28a745; color: white; border: none; padding: 3px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">System Stats</button>
            <button onclick="console.log(PulseApp.getState())" style="background: #ffc107; color: black; border: none; padding: 3px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">App State</button>
            <button onclick="PulseApp.debug.toggle()" style="background: #6f42c1; color: white; border: none; padding: 3px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">Toggle Debug</button>
            <button onclick="testAllSystems()" style="background: #fd7e14; color: white; border: none; padding: 3px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">Test Systems</button>
        </div>
    </div>

    <!-- Loading and Debug Scripts - MUST BE FIRST -->
    <script>
        // Loading progress management - DEFINED FIRST
        function updateLoadingProgress(percent, status) {
            const loadingBar = document.getElementById('loading-bar');
            const loadingStatus = document.getElementById('loading-status');
            
            if (loadingBar) {
                loadingBar.style.width = percent + '%';
            }
            if (loadingStatus) {
                loadingStatus.textContent = status;
            }
        }

        // Hide loading screen when everything is ready
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.opacity = '0';
                loadingScreen.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
        }

        // Update system status indicators
        function updateSystemStatus() {
            const statusIndicator = document.getElementById('status-indicator');
            const modulesIndicator = document.getElementById('modules-indicator');
            
            if (window.PulseApp && statusIndicator) {
                const state = PulseApp.getState();
                statusIndicator.textContent = state.initialized ? '‚úÖ Ready' : '‚ö†Ô∏è Loading';
                statusIndicator.style.color = state.initialized ? '#28a745' : '#ffc107';
                
                if (modulesIndicator) {
                    modulesIndicator.textContent = `${state.modules.length} loaded`;
                }
            }
        }

        // Debug functions
        function toggleDebug() {
            const panel = document.getElementById('debug-panel');
            const info = document.getElementById('debug-info');
            
            if (info.style.display === 'none') {
                info.style.display = 'block';
            } else {
                info.style.display = 'none';
            }
        }

        function testAllSystems() {
            console.log("=== TESTING ALL SYSTEMS ===");
            
            try {
                if (typeof PulseApp !== 'undefined') {
                    console.log("‚úÖ PulseApp loaded");
                    
                    const state = PulseApp.getState();
                    console.log("App State:", state);
                    
                    if (PulseApp.debug) {
                        const stats = PulseApp.debug.getStats();
                        console.log("System Stats:", stats);
                    }
                    
                    console.log("‚úÖ All systems operational");
                    alert("‚úÖ All systems are working correctly! Check console for details.");
                    
                } else {
                    throw new Error("PulseApp not loaded");
                }
                
            } catch (error) {
                console.error("‚ùå System test failed:", error);
                alert("‚ùå System test failed. Check console for details.");
            }
        }

        // Show debug panel in development
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.search.includes('debug=true')) {
            document.getElementById('debug-panel').style.display = 'block';
        }

        // Global error handler for script loading
        window.addEventListener('error', function(e) {
            console.error('Script loading error:', e);
            updateLoadingProgress(0, 'Error loading modules - check console');
        });

        // Listen for application ready event
        document.addEventListener('pulse:system:ready', function(event) {
            console.log('System ready event received:', event.detail);
            updateLoadingProgress(100, 'Ready!');
            updateSystemStatus();
            
            // Hide loading screen after a brief delay
            setTimeout(hideLoadingScreen, 500);
        });

        // Fallback to hide loading screen after timeout
        setTimeout(() => {
            if (document.getElementById('loading-screen').style.display !== 'none') {
                console.warn('Loading screen timeout - hiding anyway');
                hideLoadingScreen();
                updateSystemStatus();
            }
        }, 10000); // 10 second timeout

        // Update status periodically
        setInterval(updateSystemStatus, 2000);

        // Performance monitoring
        window.addEventListener('load', function() {
            const loadTime = performance.now();
            console.log(`Page loaded in ${loadTime.toFixed(2)}ms`);
            
            // Report to analytics if available
            if (window.gtag) {
                gtag('event', 'page_load_time', {
                    event_category: 'Performance',
                    value: Math.round(loadTime)
                });
            }
        });

        console.log('üöÄ Pulse Financial Visualization Platform v2.0 - Enhanced Architecture');
        console.log('üìä Loading modular components...');
    </script>

    <!-- External Libraries - LOAD EARLY -->
    <!-- D3.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js" 
            integrity="sha512-H0zmGhWdktRnojq7ML1QQ7YQDFgNg/I3A6/6QgZKr9rXCbV2P5k+/7z+l4O8I8mf0uPUWMvGPOr3TnGDiPY5IA==" 
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- D3 Sankey plugin from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js" 
            integrity="sha512-YS6KYqT5OcRvM9w5iYQWKW8KjWa1OwzQAaK1bYmSKE/k0xXOh4aKgJ0LhqJpxYJRMzOB6Cm9RJ9lq7rNUmj7pw==" 
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Scripts - Load in strict dependency order -->
    
    <!-- Step 1: Sample Data (needs to be loaded first) -->
    <script>updateLoadingProgress(10, 'Loading sample data...');</script>
    <script src="examples/sample-data.js"></script>
    
    <!-- Step 2: Core Architecture Modules (no dependencies) -->
    <script>updateLoadingProgress(20, 'Loading core modules...');</script>
    <script src="js/core/BaseChart.js"></script>
    <script src="js/core/ConfigManager.js"></script>
    <script src="js/core/ErrorHandler.js"></script>
    <script src="js/core/EventManager.js"></script>
    <script src="js/core/ChartFactory.js"></script>
    
    <!-- Step 3: Global Utilities -->
    <script>updateLoadingProgress(40, 'Loading utilities...');</script>
    <script src="js/utils/data-processor.js"></script>
    <script src="js/utils/export.js"></script>
    
    <!-- Step 4: Chart-Specific Modules (Sankey) -->
    <script>updateLoadingProgress(60, 'Loading chart modules...');</script>
    <script src="js/charts/sankey/SankeyConfig.js"></script>
    <script src="js/charts/sankey/SankeyDataProcessor.js"></script>
    <script src="js/charts/sankey/SankeyLayout.js"></script>
    <script src="js/charts/sankey/SankeyRenderer.js"></script>
    <script src="js/charts/sankey/SankeyInteractions.js"></script>
    <script src="js/charts/sankey/SankeyExport.js"></script>
    <script src="js/charts/sankey/SankeyChart.js"></script>
    
    <!-- Step 5: Main Application (depends on everything) -->
    <script>updateLoadingProgress(80, 'Initializing application...');</script>
    <script src="js/main.js"></script>

    <!-- Optional: Analytics tracking -->
    <!-- 
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    -->
</body>
</html>