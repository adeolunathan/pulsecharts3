<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Bar Chart Fix Verification</title>
    
    <style>
        body {
            font-family: Inter, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .test-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            background: #f9fafb;
            transition: all 0.2s ease;
        }
        
        .test-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
            margin-top: 10px;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-button.success {
            background: #10b981;
        }
        
        .test-button.error {
            background: #ef4444;
        }
        
        .scenario-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .scenario-desc {
            color: #6b7280;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .test-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Complete Bar Chart Fix Verification</h1>
        <p>Comprehensive testing suite to verify all bar chart control fixes work correctly across different usage scenarios.</p>
        
        <div id="test-results"></div>
        
        <div class="test-grid">
            <!-- Test 1: Direct URL Navigation -->
            <div class="test-card">
                <div class="scenario-title">üìç Direct URL Navigation</div>
                <div class="scenario-desc">
                    Tests navigating directly to chart.html?chartType=bar (simulates guided flow)
                </div>
                <button class="test-button" onclick="testDirectUrl()">Test Direct URL</button>
            </div>
            
            <!-- Test 2: With Sample Data -->
            <div class="test-card">
                <div class="scenario-title">üìä With Sample Data</div>
                <div class="scenario-desc">
                    Tests loading chart.html with pre-loaded sample data to verify controls work with data
                </div>
                <button class="test-button" onclick="testWithSampleData()">Test With Data</button>
            </div>
            
            <!-- Test 3: Chart Type Switching -->
            <div class="test-card">
                <div class="scenario-title">üîÑ Chart Type Switching</div>
                <div class="scenario-desc">
                    Tests switching between Sankey and Bar chart to verify control panel switches correctly
                </div>
                <button class="test-button" onclick="testChartSwitching()">Test Switching</button>
            </div>
            
            <!-- Test 4: Guided Flow Simulation -->
            <div class="test-card">
                <div class="scenario-title">üéØ Full Guided Flow</div>
                <div class="scenario-desc">
                    Complete simulation of user journey from guided.html ‚Üí bar chart selection ‚Üí chart.html
                </div>
                <button class="test-button" onclick="testGuidedFlow()">Test Guided Flow</button>
            </div>
            
            <!-- Test 5: Data Loading & Controls -->
            <div class="test-card">
                <div class="scenario-title">‚ö° Dynamic Controls</div>
                <div class="scenario-desc">
                    Tests that dynamic color controls are properly generated when data is loaded
                </div>
                <button class="test-button" onclick="testDynamicControls()">Test Dynamic Controls</button>
            </div>
            
            <!-- Test 6: Console Check -->
            <div class="test-card">
                <div class="scenario-title">üîç Debug Console</div>
                <div class="scenario-desc">
                    Opens browser console to check for errors and debug information during chart loading
                </div>
                <button class="test-button" onclick="openConsoleAndTest()">Check Console</button>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
            <h3 style="margin: 0 0 10px 0; color: #1e40af;">üß™ Testing Instructions</h3>
            <ul style="margin: 0; color: #1e40af; font-size: 14px;">
                <li>Click any test button to verify specific functionality</li>
                <li>Each test opens chart.html in a way that simulates real user behavior</li>
                <li>Look for proper bar chart controls (not Sankey controls) in the right sidebar</li>
                <li>Test that controls actually work by changing values and seeing visual updates</li>
                <li>Check browser console for error messages or debugging information</li>
            </ul>
        </div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `<div class="test-status ${type}">${message}</div>`;
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        function testDirectUrl() {
            showResult('üß™ Testing direct URL navigation to bar chart...', 'info');
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-complete-fix-verification.html', 'chart.html')}?chartType=bar`;
            console.log('üîó Direct URL test:', testUrl);
            
            setTimeout(() => {
                window.open(testUrl, '_blank');
            }, 1000);
        }

        function testWithSampleData() {
            showResult('üß™ Testing bar chart with sample data...', 'info');
            
            const sampleData = {
                categories: ['Q1 Sales', 'Q2 Sales', 'Q3 Sales', 'Q4 Sales', 'Marketing', 'R&D'],
                values: [150000, 175000, 195000, 220000, 45000, 67000],
                labels: ['Q1 Revenue', 'Q2 Revenue', 'Q3 Revenue', 'Q4 Revenue', 'Marketing Spend', 'R&D Investment']
            };
            
            const encodedData = encodeURIComponent(JSON.stringify(sampleData));
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-complete-fix-verification.html', 'chart.html')}?chartType=bar&data=${encodedData}`;
            console.log('üîó Sample data test:', testUrl);
            
            setTimeout(() => {
                window.open(testUrl, '_blank');
            }, 1000);
        }

        function testChartSwitching() {
            showResult('üß™ Testing chart type switching...', 'info');
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-complete-fix-verification.html', 'chart.html')}?type=income`;
            console.log('üîó Chart switching test (starts with Sankey):', testUrl);
            
            setTimeout(() => {
                const newWindow = window.open(testUrl, '_blank');
                
                // Give instructions for manual testing
                setTimeout(() => {
                    showResult('üìù Manual Test: In the opened window, use the chart type dropdown in the header to switch from Sankey to Bar chart. Verify that the controls change properly.', 'warning');
                }, 2000);
            }, 1000);
        }

        function testGuidedFlow() {
            showResult('üß™ Testing complete guided flow...', 'info');
            const guidedUrl = `${window.location.origin}${window.location.pathname.replace('test-complete-fix-verification.html', 'guided.html')}`;
            console.log('üîó Guided flow test:', guidedUrl);
            
            setTimeout(() => {
                const newWindow = window.open(guidedUrl, '_blank');
                
                setTimeout(() => {
                    showResult('üìù Manual Test: In the opened guided.html, select "Bar Chart" option and verify that you get redirected to chart.html with proper bar chart controls.', 'warning');
                }, 2000);
            }, 1000);
        }

        function testDynamicControls() {
            showResult('üß™ Testing dynamic control generation...', 'info');
            
            // Create data with specific category names to test dynamic color controls
            const testData = {
                categories: ['Revenue', 'Expenses', 'Profit', 'Growth', 'Investment'],
                values: [500000, 350000, 150000, 75000, 125000],
                labels: ['Total Revenue', 'Operating Expenses', 'Net Profit', 'Year-over-Year Growth', 'Capital Investment']
            };
            
            const encodedData = encodeURIComponent(JSON.stringify(testData));
            const testUrl = `${window.location.origin}${window.location.pathname.replace('test-complete-fix-verification.html', 'chart.html')}?chartType=bar&data=${encodedData}`;
            console.log('üîó Dynamic controls test:', testUrl);
            
            setTimeout(() => {
                const newWindow = window.open(testUrl, '_blank');
                
                setTimeout(() => {
                    showResult('üìù Manual Test: In the opened window, check the control panel for "Bar Colors" section with individual color pickers for Revenue, Expenses, Profit, Growth, and Investment. Test that changing colors actually updates the chart.', 'warning');
                }, 2000);
            }, 1000);
        }

        function openConsoleAndTest() {
            showResult('üß™ Opening console for debugging...', 'info');
            
            // Instructions for console debugging
            showResult(`
                üîç <strong>Console Debugging Instructions:</strong><br>
                1. Press F12 or right-click ‚Üí Inspect to open browser console<br>
                2. Click the "Test With Data" button above<br>
                3. Watch console for messages starting with üéõÔ∏è, üìä, ‚úÖ, ‚ùå<br>
                4. Look for any error messages or failed operations<br>
                5. Verify that "Applied bar chart control" messages appear when you change controls
            `, 'info');
            
            // Auto-run a test for console monitoring
            setTimeout(() => {
                testWithSampleData();
            }, 3000);
        }

        // Show initial instructions
        showResult('üëÜ Select any test scenario above to verify the bar chart control fixes. Each test opens chart.html in different ways to simulate real user behavior.', 'info');
    </script>
</body>
</html>